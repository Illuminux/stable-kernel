From 1e420f2c6303cc2dbbd8322f5f5d89013edebe1c Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Thu, 16 Sep 2010 14:48:42 -0500
Subject: [PATCH 12/22] ARM OMAP Touchbook upstream omap3_ads_init to touchbook_ads_init

---
 arch/arm/mach-omap2/board-omap3touchbook.c |   47 +++++++++++++---------------
 1 files changed, 22 insertions(+), 25 deletions(-)

diff --git a/arch/arm/mach-omap2/board-omap3touchbook.c b/arch/arm/mach-omap2/board-omap3touchbook.c
index 3e657be..11cbb8f 100644
--- a/arch/arm/mach-omap2/board-omap3touchbook.c
+++ b/arch/arm/mach-omap2/board-omap3touchbook.c
@@ -58,7 +58,6 @@
 #include "sdram-micron-mt46h32m32lf-6.h"
 
 #define OMAP3_AC_GPIO		136
-#define OMAP3_TS_GPIO		162
 #define TB_BL_PWM_TIMER		9
 #define TB_KILL_POWER_GPIO	168
 
@@ -363,21 +362,7 @@ static int __init omap3_touchbook_i2c_init(void)
 	return 0;
 }
 
-static void __init omap3_ads7846_init(void)
-{
-	omap_mux_init_gpio(OMAP3_TS_GPIO, OMAP_PIN_INPUT_PULLUP);
-
-	if (gpio_request(OMAP3_TS_GPIO, "ads7846_pen_down")) {
-		printk(KERN_ERR "Failed to request GPIO %d for "
-				"ads7846 pen down IRQ\n", OMAP3_TS_GPIO);
-		return;
-	}
-
-	gpio_direction_input(OMAP3_TS_GPIO);
-	gpio_set_debounce(OMAP3_TS_GPIO, 310);
-}
-
-static struct ads7846_platform_data ads7846_config = {
+static struct ads7846_platform_data touchbook_ads7846_config = {
 	.x_min			= 100,
 	.y_min			= 265,
 	.x_max			= 3950,
@@ -387,27 +372,39 @@ static struct ads7846_platform_data ads7846_config = {
 	.debounce_max		= 10,
 	.debounce_tol		= 5,
 	.debounce_rep		= 1,
-	.gpio_pendown		= OMAP3_TS_GPIO,
+	.gpio_pendown		= 162,
 	.keep_vref_on		= 1,
 };
 
-static struct omap2_mcspi_device_config ads7846_mcspi_config = {
+static struct omap2_mcspi_device_config touchbook_ads7846_mcspi_config = {
 	.turbo_mode	= 0,
 	.single_channel	= 1,	/* 0: slave, 1: master */
 };
 
-static struct spi_board_info omap3_ads7846_spi_board_info[] __initdata = {
+static struct spi_board_info __initdata touchbook_spi_board_info[] = {
 	{
 		.modalias		= "ads7846",
 		.bus_num		= 4,
 		.chip_select		= 0,
 		.max_speed_hz		= 1500000,
-		.controller_data	= &ads7846_mcspi_config,
-		.irq			= OMAP_GPIO_IRQ(OMAP3_TS_GPIO),
-		.platform_data		= &ads7846_config,
+		.controller_data	= &touchbook_ads7846_mcspi_config,
+		.irq			= OMAP_GPIO_IRQ(162),
+		.platform_data		= &touchbook_ads7846_config,
 	}
 };
 
+static void __init touchbook_ads7846_init(void)
+{
+	int touchbook_ads7846_gpio = 162;
+	if (gpio_request(touchbook_ads7846_gpio, "ads7846_pen_down")) {
+		printk(KERN_ERR "Failed to request GPIO %d for ads7846 pen down IRQ\n", touchbook_ads7846_gpio);
+		return;
+	}
+
+	gpio_direction_input(touchbook_ads7846_gpio);
+	gpio_set_debounce(touchbook_ads7846_gpio, 310);
+}
+
 static struct gpio_led gpio_leds[] = {
 	{
 		.name			= "touchbook::usr0",
@@ -581,9 +578,9 @@ static void __init touchbook_init(void)
 	gpio_direction_output(176, true);
 
 	/* Touchscreen and accelerometer */
-	spi_register_board_info(omap3_ads7846_spi_board_info,
-				ARRAY_SIZE(omap3_ads7846_spi_board_info));
-	omap3_ads7846_init();
+	spi_register_board_info(touchbook_spi_board_info, ARRAY_SIZE(touchbook_spi_board_info));
+	touchbook_ads7846_init();
+
 	usb_musb_init(&musb_board_data);
 	usb_ehci_init(&ehci_pdata);
 	touchbook_flash_init();
-- 
1.7.1

