From 3b659fe4da625dd3f461158c96de81744814b05f Mon Sep 17 00:00:00 2001
From: Robert Nelson <robertcnelson@gmail.com>
Date: Thu, 16 Sep 2010 16:37:15 -0500
Subject: [PATCH 1/5] ARM OMAP Touchbook upstream match leds keys gpio

---
 arch/arm/mach-omap2/board-omap3touchbook.c |   45 ++++++++++++---------------
 1 files changed, 20 insertions(+), 25 deletions(-)

diff --git a/arch/arm/mach-omap2/board-omap3touchbook.c b/arch/arm/mach-omap2/board-omap3touchbook.c
index 35135b2..6f049f6 100644
--- a/arch/arm/mach-omap2/board-omap3touchbook.c
+++ b/arch/arm/mach-omap2/board-omap3touchbook.c
@@ -240,7 +240,7 @@ static int touchbook_twl_gpio_setup(struct device *dev,
 	gpio_direction_output(gpio + TWL4030_GPIO_MAX, 0);
 
 	/* TWL4030_GPIO_MAX + 1 == ledB, PMU_STAT (out, active low LED) */
-	gpio_leds[2].gpio = gpio + TWL4030_GPIO_MAX + 1;
+//	gpio_leds[2].gpio = gpio + TWL4030_GPIO_MAX + 1;
 
 	return 0;
 }
@@ -393,7 +393,7 @@ static int __init touchbook_i2c_init(void)
 	return 0;
 }
 
-static struct gpio_led gpio_leds[] = {
+static struct gpio_led touchbook_gpio_leds[] = {
 	{
 		.name			= "touchbook::usr0",
 		.default_trigger	= "heartbeat",
@@ -404,30 +404,24 @@ static struct gpio_led gpio_leds[] = {
 		.default_trigger	= "mmc0",
 		.gpio			= 149,
 	},
-	{
-		.name			= "touchbook::pmu_stat",
-		.gpio			= -EINVAL,	/* gets replaced */
-		.active_low		= true,
-	},
 };
 
-
-static struct gpio_led_platform_data gpio_led_info = {
-	.leds		= gpio_leds,
-	.num_leds	= ARRAY_SIZE(gpio_leds),
+static struct gpio_led_platform_data touchbook_gpio_led_info = {
+	.leds		= touchbook_gpio_leds,
+	.num_leds	= ARRAY_SIZE(touchbook_gpio_leds),
 };
 
-static struct platform_device leds_gpio = {
+static struct platform_device touchbook_leds_gpio = {
 	.name	= "leds-gpio",
 	.id	= -1,
 	.dev	= {
-		.platform_data	= &gpio_led_info,
+		.platform_data	= &touchbook_gpio_led_info,
 	},
 };
 
-static struct gpio_keys_button gpio_buttons[] = {
+static struct gpio_keys_button touchbook_gpio_buttons[] = {
 	{
-		.code			= BTN_EXTRA,
+		.code			= KEY_BACK,
 		.gpio			= 7,
 		.desc			= "user",
 		.wakeup			= 1,
@@ -437,25 +431,26 @@ static struct gpio_keys_button gpio_buttons[] = {
 		.gpio			= 183,
 		.desc			= "power",
 		.wakeup			= 1,
+		.active_low		= 1,
 	},
 };
 
-static struct gpio_keys_platform_data gpio_key_info = {
-	.buttons	= gpio_buttons,
-	.nbuttons	= ARRAY_SIZE(gpio_buttons),
+static struct gpio_keys_platform_data touchbook_gpio_key_info = {
+	.buttons	= touchbook_gpio_buttons,
+	.nbuttons	= ARRAY_SIZE(touchbook_gpio_buttons),
 };
 
-static struct platform_device keys_gpio = {
+static struct platform_device touchbook_keys_gpio = {
 	.name	= "gpio-keys",
 	.id	= -1,
 	.dev	= {
-		.platform_data	= &gpio_key_info,
+		.platform_data	= &touchbook_gpio_key_info,
 	},
 };
 
-static struct platform_device *omap3_touchbook_devices[] __initdata = {
-	&leds_gpio,
-	&keys_gpio,
+static struct platform_device __initdata *touchbook_devices[] = {
+	&touchbook_leds_gpio,
+	&touchbook_keys_gpio,
 	&touchbook_dss_device,
 };
 
@@ -626,8 +621,7 @@ static void __init touchbook_init(void)
 
 	omap3_mux_init(board_mux, OMAP_PACKAGE_CBB);
 	touchbook_i2c_init();
-	platform_add_devices(omap3_touchbook_devices,
-			ARRAY_SIZE(omap3_touchbook_devices));
+	platform_add_devices(touchbook_devices, ARRAY_SIZE(touchbook_devices));
 	omap_serial_init();
 
 	omap_mux_init_gpio(170, OMAP_PIN_INPUT);
@@ -649,6 +643,7 @@ static void __init touchbook_init(void)
 	spi_register_board_info(touchbook_spi_board_info_4, ARRAY_SIZE(touchbook_spi_board_info_4));
 	spi_register_board_info(touchbook_spi_board_info_3, ARRAY_SIZE(touchbook_spi_board_info_3));
 	touchbook_ads7846_init();
+	touchbook_mma7455l_init();
 }
 
 static void __init touchbook_init_irq(void)
-- 
1.7.1

